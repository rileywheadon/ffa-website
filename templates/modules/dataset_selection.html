{% extends "module.html" %}

{% from "status_bar.html" import statusBar %}
{% from "control_bar.html" import controlBar %}
{% from "macros.html" import spinner %}

{% block status %} {{ statusBar(1) }} {% endblock %}

{% block module_left %}

	<div 
		class="w-full h-full flex flex-col items-center gap-y-4 overflow-y-auto" 
		x-data="{'local': {{ 'true' if results and "file_name" in results else 'false' }}}"
	>

		<div class="w-full flex flex-row border border-gray-300 rounded-lg text-center cursor-pointer">
			<a 
				class="rounded-l-lg w-1/2 py-1 border-r border-gray-300 transform transition duration-300 ease-in-out hover:bg-gray-300"
				x-on:click="local = false; if (map) setTimeout(() => map.invalidateSize(), 100);"
				x-bind:class="local ? '' : 'underline'"
			>
				Select a Hydrometric Station
			</a>
			<a 
				x-on:click="local = true"
				x-bind:class="local ? 'underline' : ''"
				class="rounded-r-lg w-1/2 py-1 transform transition duration-300 ease-in-out hover:bg-gray-300"
			>
				Upload a CSV File
			</a>
		</div>

		<div class="w-full h-full border border-gray-300 rounded-lg">

			<!-- Select a Station -->
			<div 
				id="map" 
				x-bind:class="local ? 'hidden' : ''"
				class="z-10 h-full rounded-lg"
			>

			</div>

			<!-- Upload a CSV File	-->
			<form 
				x-bind:class="local ? '' : 'hidden'"
				class="h-full flex flex-row items-center justify-center gap-x-2"
				action="/dataset-local" 
				method="post"
				enctype="multipart/form-data"
			>
				<div 
					x-data="{fileName: '{{ results.file_name | default('') }}'}" 
					class="flex flex-row gap-x-2"
				>
					<label
						for="file-upload"
						class="cursor-pointer inline-flex items-center px-4 bg-gray-600 text-white font-medium rounded-lg h-10 shadow"
					>
						Browse
					</label>
					<input
						id="file-upload"
						class="sr-only"
						type="file"
						name="file"
						@change="fileName = $event.target.files[0]?.name"
					>
					<div x-text="fileName" class="w-52 text-gray-700 border border-gray-300 rounded-lg flex flex-row items-center px-2"></div>
				</div>
				<button
					type="submit"
					class="h-10 px-4 bg-sky-600 font-medium text-white rounded-lg max-w-md shadow"
				>
					Upload
				</button>
			</form>

		</div>

	</div>

{% endblock %}

{% block module_right %}

	<div class="border border-gray-300 rounded-lg p-4 flex flex-col gap-y-2">

		<div class="flex-none w-full text-center underline">Module Summary</div>

		<p>The FFA framework uses annual maximum series data. The data for stations on the map is provided by <a href="https://www.canada.ca/en/environment-climate-change/services/water-overview/quantity/monitoring/survey/data-products-services/national-archive-hydat.html" class="underline text-sky-600">HYDAT</a>, which measures streamflow in m<sup>3</sup>/s.</p>

	</div>

	<div class="grow border border-gray-300 rounded-lg p-4 flex flex-col gap-y-2">

		<div class="flex-none w-full text-center underline">Dataset Overview</div>

		{% if not results %}

			<div class="grow flex flex-col gap-y-2">
				<p>No dataset selected.</p>			
			</div>

		{% else %}

			<div class="grow flex flex-col gap-y-2">

				{% if "file_name" in results %}
					{% include "modules/dataset_local.html" %}
				{% else %}
					{% include "modules/dataset_geomet.html" %}
				{% endif %}

			</div>

			<div class="flex flex-row gap-x-2">
				{% if "file_name" not in results %}
					<a 
						class="text-sky-600 underline cursor-pointer"
						href="/download-geomet/{{ results.station_number }}"
						download
					>Download Data</a> 
					&bull;
				{% endif %}
				<a 
					class="text-sky-600 underline cursor-pointer"
					hx-get="/view-plot"
					hx-target="#modal-container"
					hx-swap="innerHTML"
				>View Plot</a> 
				&bull;
				<a 
					class="text-sky-600 underline cursor-pointer"
					href="/download-plot"
					download
				>Download Plot</a>
			</div>

		{% endif %}

	</div>

{% endblock %}

{% block controls %} 
	{{ controlBar("dataset-selection", "change-point-detection") }}
{% endblock %}
